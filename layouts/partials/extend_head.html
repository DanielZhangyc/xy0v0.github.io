{{if .Page.Site.Params.lightgallery }}
<!-- lightgallery -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.7.1/css/lightgallery-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.1/lightgallery.min.js"></script>

<!-- Initialize -->
<script>
window.addEventListener('load', function() {
    // 获取当前文章的图片
    const articles = document.querySelectorAll('.post-single');
    articles.forEach(function(article) {
        const images = article.querySelectorAll('.post-content img');
        if (images.length > 0) {
            // 为每个图片添加父元素和data属性
            images.forEach(function(img) {
                const container = document.createElement('a');
                container.href = img.src;
                container.setAttribute('data-src', img.src);
                img.parentNode.insertBefore(container, img);
                container.appendChild(img);
            });
            
            // 初始化 lightGallery
            lightGallery(article.querySelector('.post-content'), {
                selector: 'a',
                controls: false,
                thumbnail: false,
                escKey: true,
                hideScrollbar: true,
                counter: false
            });
        }
    });
});
</script>
{{ end }}

{{if .Page.Site.Params.mermaid }}
<!-- mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
<script>
window.addEventListener('load', function() {
    const isDark = document.documentElement.classList.contains('dark');
    mermaid.initialize({
        startOnLoad: true,
        theme: isDark ? 'dark' : 'default',
        flowchart: {
            useMaxWidth: true,
            htmlLabels: true,
            curve: 'basis',
            nodeSpacing: 50,
            rankSpacing: 50,
        },
        themeVariables: isDark ? {
            primaryColor: '#3B4252',
            primaryTextColor: '#ECEFF4',
            primaryBorderColor: '#81A1C1',
            lineColor: '#88C0D0',
            secondaryColor: '#434C5E',
            tertiaryColor: '#4C566A',
            mainBkg: '#2E3440',
            nodeBorder: '#81A1C1',
            clusterBkg: '#2E3440',
            clusterBorder: '#81A1C1',
            titleColor: '#88C0D0',
            edgeLabelBackground: '#2E3440',
            nodeTextColor: '#ECEFF4'
        } : {
            primaryColor: '#E2E8F0',
            primaryTextColor: '#2D3748',
            primaryBorderColor: '#CBD5E0',
            lineColor: '#4A5568',
            secondaryColor: '#EDF2F7',
            tertiaryColor: '#E2E8F0'
        },
        securityLevel: 'loose'
    });

    // 查找所有 mermaid 代码块并初始化
    document.querySelectorAll('pre code.language-mermaid, .mermaid').forEach(function(element) {
        if (element.tagName === 'CODE') {
            const div = document.createElement('div');
            div.className = 'mermaid';
            div.textContent = element.textContent;
            element.parentElement.replaceWith(div);
        }
    });
});
</script>
<style>
.mermaid {
    text-align: center;
    border-radius: 8px;
    padding: 1.5em;
    margin: 1em 0;
}
.dark .mermaid {
    filter: brightness(0.95);
}
.mermaid .node rect,
.mermaid .node circle,
.mermaid .node ellipse,
.mermaid .node polygon,
.mermaid .node path {
    stroke-width: 2px;
    rx: 5;
    ry: 5;
}
.dark .mermaid .node rect,
.dark .mermaid .node circle,
.dark .mermaid .node ellipse,
.dark .mermaid .node polygon,
.dark .mermaid .node path {
    fill: #3B4252;
    stroke: #81A1C1;
}
.mermaid .edgeLabel {
    background-color: transparent !important;
    color: inherit !important;
}
.dark .mermaid .edgeLabel {
    color: #ECEFF4 !important;
}
.mermaid .flowchart-link {
    stroke-width: 2px !important;
}
.dark .mermaid .flowchart-link {
    stroke: #88C0D0 !important;
}
.dark .mermaid marker {
    fill: #88C0D0 !important;
}
</style>
{{ end }}

<style>
.feather {
    width: 1em;
    height: 1em;
    vertical-align: -0.125em;
    margin-right: 0.3em;
    stroke: currentColor;
}
</style> 